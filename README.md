Обновляет сертификат LetsEncrypt для использования SSTP на устройствах Mikrotik.

Проект является обёрткой над https://github.com/danb35/letsencrypt-routeros

Проект появился потому что очевидный вариант с [acme.sh](https://github.com/acmesh-official/acme.sh) не заработал.

## Основной скрипт Update-LECertificate.ps1

```bash
# pwsh ./Modify-DnsTxtRecord.ps1 <FQDN-имя> <SSH-порт>
pwsh ./Modify-DnsTxtRecord.ps1 vpn1.domain.com 22
```

Что делает скрипт:
<!-- TODO Добавь описание -->

## Дополнительные функции

### Set-CertbotInitialSetup.ps1

Скрипт инициализации нового микротика

Что делает скрипт:
1. Генерирует рандомный пароль для пользователя (по умолчанию, имя пользователя - certbot) для беспарольного управления микротиком.
2. Копирует публичный ключ (по умолчанию, /opt/letsencrypt-routeros/id_rsa.pub) на микротик.
3. Создаёт пользователя (из пункта 1) на микротике и импортируем ему ключ (из пункта 2).

У скрипта есть ряд параметров:

| Параметр (* - обязательный)   | Описание                                      	        | Значение по умолчанию                 |
|-------------------------------|-----------------------------------------------------------|---------------------------------------|
| SshUser*                      | Имя пользователя для подключения к устройству 	        | Нет                                   |
| SshHost*                      | Адрес устройства                              	        | Нет                                   |
| SshPort*                      | Порт для подключения к устройству             	        | 22                                    |
| MtCertBotUser                 | Имя пользователя, который будет создан на устройстве	    | certbot                               |
| SshKeyPath                    | Публичный ключ, который будет использован для подключения	| /opt/letsencrypt-routeros/id_rsa.pub  |
| TempConfigFile                | Локальный путь к временному конфигу для устройства    	| /tmp/certbot_initial_config.rsc       |

```bash
Set-CertbotInitialSetup -SshUser admin_user -SshHost vpn1.domain.com -SshPort 2222
```

### Get-CertbotTxtRecord.ps1

Скрипт запроса необходимой TXT-записи 

Что делает скрипт:
1. Получает текст, которую certbot ожидает увидеть на DNS-сервере у ТХТ-записи _acme-challenge.vpn1.domain.com.
2. Сохраняет этот текст в файл, чтобы основной скрипт мог использовать его в будущем для обновления информации на DNS-сервере

```bash
Get-CertbotTxtRecord -FQDN vpn1.domain.com
```

### New-CertbotConfig.ps1

Скрипт генерации конфига для certbot

Что делает скрипт:
1. Создаёт конфиг для дальнейшей передачи его бинарнику certbot

У скрипта есть ряд параметров:

| Параметр (* - обязательный)   | Описание                                      	        | Значение по умолчанию                 |
|-------------------------------|-----------------------------------------------------------|---------------------------------------|
| RouterOsUser                  | Имя пользователя для подключения к устройству 	        | certbot                               |
| RouterOsHost*                 | Адрес устройства                              	        | Нет                                   |
| RouterOsSshPort               | Порт для подключения к устройству             	        | 22                                    |
| RouterOSPrivateKey            | Приватный ключ для авторизации на устройстве       	    | /opt/letsencrypt-routeros/id_rsa      |
| ConfigPath                    | Путь, куда будет сохранён файл конфига                	| /tmp/routeros.settings                |

```bash
New-CertbotConfig -RouterOsHost $FQDN -RouterOsSshPort $SshPort
```

### Set-DnsRecord.ps1

Скрипт 

Что делает скрипт:
1. Заменяет TXT-запись _acme-challenge на указанном DNS-сервере

У скрипта есть ряд параметров:

| Параметр (* - обязательный)   | Описание                                      	        | Значение по умолчанию                 |
|-------------------------------|-----------------------------------------------------------|---------------------------------------|
| DnsServerAddress*             | Адрес/имя DNS-сервера	                                    | Нет                                   |
| FQDN*                         | FQDN-имя домена, для которого обновляем TXT-запись        | Нет                                   |
| Credential*                   | Учётные данные для подключения к DNS-серверу     	        | Нет                                   |
| TxtRecordValue*               | Значение TXT-записи                                  	    | Нет                                   |

### Start-CoundownTimer.ps1

Скрипт обратного отсчёта времени

Что делает скрипт:
1. Ведёт обратный отсчёт времени засыпая на нужное количество минут

У скрипта есть ряд параметров:

| Параметр (* - обязательный)   | Описание                                      	        | Значение по умолчанию                 |
|-------------------------------|-----------------------------------------------------------|---------------------------------------|
| Minutes                       | Количество минут                               	        | 1                                     |

### Get-CertsExpire.py

Что делает скрипт:
1. Проходит по всем подпапкам в /etc/letsencrypt/live, смотрит ранее выданные сертификаты и проверяет дату их истечения

Вызывается так:
```bash
python ./Get-CertsExpire.py
```

<!-- TODO Добавь аргументы для скрипта -->

[TODO]
Сделай возможность проверять отдельный сертификат и запускать главный скрипт для обновления сертификата. Добавь задачу в планировщик.